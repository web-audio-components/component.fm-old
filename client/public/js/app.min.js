var app=app||{};app.views={},app.models={},app.collections={},app.templates={},app.config={},this.app=this.app||{},this.app.templates=this.app.templates||{},this.app.templates.index=function(e,t,n,r,i){return n=n||e.helpers,'<div class="row">\n  <h1>Web Audio Package Manager</h1>\n  <div>\n    This is a collection of modules for the Web Audio API. Browse and demo them on this site, check out the <a href="https://github.com/wapm/web-audio-module-spec/blob/master/wapm-spec.md" title="WAPM spec">spec</a> for making your own modules, and use the <a href="https://github.com/wapm/wapm-cli" title="WAPM node tool">node.js CLI</a> for pulling down modules.\n  </div>\n  <div>\n    This is a work in progress, please submit any issues and feedback to the appropriate project on the <a href="https://github.com/wapm">WAPM GitHub page</a>!\n  </div>\n</div>\n\n'},this.app.templates["package"]=function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="row">\n  <h1>',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+'</h1>\n  <div class="description">',u=n.description,u?o=u.call(t,{hash:{}}):(o=t.description,o=typeof o===a?o():o),s+=f(o)+'</div>\n  <table class="table table-bordered table-striped">\n    <tbody>\n      <tr>\n        <td class="attribute-label">author</td>\n        <td>\n          ',u=n.author,u?o=u.call(t,{hash:{}}):(o=t.author,o=typeof o===a?o():o),s+=f(o)+'\n        </td>\n      </tr>\n      <tr>\n        <td class="attribute-label">repo</td>\n        <td><a href="https://github.com/',u=n.repo,u?o=u.call(t,{hash:{}}):(o=t.repo,o=typeof o===a?o():o),s+=f(o)+'" title="GitHub repository for ',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+'">',u=n.repo,u?o=u.call(t,{hash:{}}):(o=t.repo,o=typeof o===a?o():o),s+=f(o)+'</a></td>\n      </tr>\n      <tr>\n        <td class="attribute-label">keywords</td>\n        <td>',u=n.keywords,u?o=u.call(t,{hash:{}}):(o=t.keywords,o=typeof o===a?o():o),s+=f(o)+'</td>\n      </tr>\n      <tr>\n        <td class="attribute-label">updated</td>\n        <td>',u=n.updated,u?o=u.call(t,{hash:{}}):(o=t.updated,o=typeof o===a?o():o),s+=f(o)+'</td>\n      </tr>\n      <tr>\n        <td class="attribute-label">watchers</td>\n        <td>',u=n.watchers,u?o=u.call(t,{hash:{}}):(o=t.watchers,o=typeof o===a?o():o),s+=f(o)+' stars</td>\n      </tr>\n    </tbody>\n  </table>\n  <div class="activate-player">\n    <a href="#">Demo this module</a>\n  </div>\n</div>\n',s},this.app.templates.player=function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="row">\n  <select class="samples">\n    <option value="vox">vocals</li>\n    <option value="lead">acoustic guitar lead</li>\n    <option value="rhythm">acoustic guitar rhythm</li>\n    <option value="solo-dry">electric guitar lead</li>\n  </select>\n  <div class="module well">\n    <h3>',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+"</h3>\n\n  </div>\n</div>\n\n",s},this.app.templates.searchBar=function(e,t,n,r,i){return n=n||e.helpers,'<div class="row">\n  <form class="form-search">\n    <div class="input-prepend">\n      <span class="add-on"><i class="icon icon-search"></i></span>\n      <input type="search" class="search-query" id="search-bar" placeholder="plate delay"/>\n    </div>\n  </form>\n</div>\n'},this.app.templates.searchResults=function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n    <h2>Results for ",s=n.query,s?i=s.call(e,{hash:{}}):(i=e.query,i=typeof i===u?i():i),r+=a(i)+"</h2>\n  ",r}function c(e,t){return"\n    <h2>Recent packages</h2>\n  "}function h(e,t){var r="",i,s;return r+='\n      <li><a href="#" data-id="',s=n.id,s?i=s.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i():i),r+=a(i)+'" data-name="',s=n.name,s?i=s.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i():i),r+=a(i)+'">',s=n.name,s?i=s.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i():i),r+=a(i)+" - ",s=n.description,s?i=s.call(e,{hash:{}}):(i=e.description,i=typeof i===u?i():i),r+=a(i)+"</a></li>\n    ",r}n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="row">\n  ',o=t.query,o=n["if"].call(t,o,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\n  <ul class="nav nav-tabs nav-stacked">\n    ',o=t.packages,o=n.each.call(t,o,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+="\n  </ul>\n</div>\n",s},function(){app.models.Package=Backbone.Model.extend({initialize:function(){},matches:function(e){var t=e.split(" "),n=!1,r=this;return t=_.map(t,function(e){return new RegExp(e,"gi")}),_.each(t,function(e){if(_.any(r.get("keywords")||[],function(t){return t.match(e)})||r.get("description").match(e)||r.get("name").match(e))n=!0}),n}})}(),function(){app.collections.Packages=Backbone.Collection.extend({model:app.models.Package,url:"/packages",initialize:function(){}})}(),function(){var e=app.views.index,t=app.views.search,n=app.views.package,r=app.views.about,i=Backbone.Router.extend({routes:{"":"index","packages/search/:name":"search","packages/:package":"package",about:"about"},index:function(){},search:function(){}});app.router=new i}(),function(){app.views.View=Backbone.View.extend({render:function(){this.template=this.template||Handlebars.template(app.templates[this.name]);var e=this.getRenderData?this.getRenderData():{};$("#content").append(this.$el.html(this.template(e)))},hide:function(){this.$el.slideUp()},show:function(){this.$el.slideDown()}})}(),function(){app.views.Index=app.views.View.extend({name:"index",className:"index-view",initialize:function(e){this.search=e.search,this.packages=e.packages,this.search.on("query",this.hide,this),this.packages.on("select",this.hide,this),this.render()}})}(),function(){app.views.Package=app.views.View.extend({name:"package",className:"package-view",events:{"click .activate-player a":"handleActivateDemo"},initialize:function(e){this.packages=e.packages,this.search=e.search,this.packages.on("select",this.setPackage,this),this.search.on("query",this.hide,this)},setPackage:function(e){app.router.navigate("/package/"+e.get("name")),this.package=e,this.show(),this.render()},getRenderData:function(){var e=this.package.toJSON();return e.updated=this.formatDate(e.updated),e.keywords=this.formatKeywords(e.keywords),e},formatDate:function(e){return moment(e).format("MMMM Do YYYY")},formatKeywords:function(e){return(e||[]).join(", ")},handleActivateDemo:function(e){e.preventDefault(),this.trigger("activate:demo",this.package)}})}(),function(){app.views.Player=app.views.View.extend({name:"player",className:"player-view",initialize:function(e){this.packageView=e.packageView,this.context=new(window.AudioContext||window.webkitAudioContext),this.packageView.on("activate:demo",this.selectPackage,this),this.$el.data("hidden",!0),this.$(".samples").change(),this.render()},events:{"change .samples":"handleLoadSample"},selectPackage:function(e){this.package=e,this.loadPackage()},loadPackage:function(){var e=this;this.$el.data("hidden")&&this.showPlayer(),require(["/packages/"+this.package.get("name")+"/script.js"],function(t){e.module=new t(e.context),e.packageLoaded(),e.module.connect(e.context.destination)})},packageLoaded:function(){},handleLoadSample:function(e){var t=$(e.target).find(":selected").val();this.loadSample(t)},loadSample:function(e){var t=this;this.source&&this.source.noteOff&&this.source.noteOff(0),this.source=this.context.createBufferSource();var n=new XMLHttpRequest;n.open("GET","samples/"+e+".mp3",!0),n.responseType="arraybuffer",n.onload=function(e){t.loadedSample(e,n)},n.send()},loadedSample:function(e,t){this.source.buffer=this.context.createBuffer(t.response,!1),this.module&&this.source.connect(this.module.input),this.source.noteOn(0)},showPlayer:function(){this.$el.animate({"margin-bottom":"0px"}),this.$el.data("hidden",!1)},hidePlayer:function(){this.$el.animate({"margin-bottom":"-150px"}),this.$el.data("hidden",!0)}})}(),function(){app.views.SearchBar=app.views.View.extend({name:"searchBar",className:"search-bar-view",initialize:function(){var e=this;this.triggerQuery=_.debounce(function(t){e.trigger("query",t)},200),this.render()},events:{"keyup #search-bar":"handleSearch"},handleSearch:function(e){var t=$(e.target).val();t=this.sanitizeQuery(t),this.triggerQuery(t)},sanitizeQuery:function(e){return e.replace(/[^\w ]/g,"")}})}(),function(){app.views.SearchResults=app.views.View.extend({name:"searchResults",className:"search-results-view",events:{"click a":"handlePackageSelect"},initialize:function(e){var t=this;this.search=e.search,this.packages=e.packages,this.filteredPackages=this.packages,this.search.on("query",this.onQuery,this),this.packages.on("select",this.onSelect,this),this.packages.fetch({success:function(){t.render()}})},filterPackages:function(e){var t;e?(t=this.packages.filter(function(t){return t.matches(e)}),this.filteredPackages=new app.collections.Packages(t)):this.filteredPackages=this.packages,app.router.navigate("/package/search/"+e),this.query=e,this.render()},getRenderData:function(){return{packages:this.filteredPackages.toJSON(),query:this.query}},handlePackageSelect:function(e){var t=$(e.target).data("name"),n=this.packages.where({name:t})[0];e.preventDefault(),this.packages.trigger("select",n)},onQuery:function(e){this.show(),this.filterPackages(e)},onSelect:function(){this.hide()}})}(),app.init=function(){app.packages=new app.collections.Packages,app.searchBarView=new app.views.SearchBar,app.searchResultsView=new app.views.SearchResults({search:app.searchBarView,packages:app.packages}),app.packageView=new app.views.Package({search:app.searchBarView,resultsView:app.searchResultsView,packages:app.packages}),app.playerView=new app.views.Player({packageView:app.packageView}),app.indexView=new app.views.Index({packages:app.packages,search:app.searchBarView})},$(function(){app.init.call(app),Backbone.history.start()});