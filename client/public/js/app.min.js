var app=app||{};app.views={},app.models={},app.collections={},app.templates={},app.config={},this.app=this.app||{},this.app.templates=this.app.templates||{},this.app.templates.index=function(e,t,n,r,i){return n=n||e.helpers,'<div class="row">\n  <h1>Web Audio Package Manager</h1>\n  <p>This app is 3 separate components (maybe more, not sure). The goal was to create a package manager for web audio API nodes so they can be accessed all in one place, and browsable on an app, where if they follow a spec, they\'ll be able to be played in a browser so devs can try them out.</p>\n  <p>The <a href="https://github.com/wapm/wapm-cli">CLI</a> for registering packages is still incomplete, but sending packages to the service.</p>\n  <p>The <a href="https://github.com/wapm/wapm-service">service</a> stores information about the packages and exposes an API for use.</p>\n  <p>The app (this) is in the NKO repo, although all of these were started for 48 hours ago.</p>\n  <p>They all need a lot of love and will be worked on over the next few weeks, but this seemed a bit ambitious for one person :) Will iron out the spec, service, CLI and browsable app in the weeks to come, add components so the effects can be tweeked while browsing, etc.. also a lot of styling love.</p>\n  <p>To try it out, <strong>search for "reverb"</strong>, and then load up a sample below!</p>\n  <p><strong>Only works with the Web Audio API (webkit only at the moment)</strong></p>\n</div>\n\n'},this.app.templates["package"]=function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="row">\n  <h1>',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+'</h1>\n  <div class="description">',u=n.description,u?o=u.call(t,{hash:{}}):(o=t.description,o=typeof o===a?o():o),s+=f(o)+'</div>\n  <table class="table table-bordered table-striped">\n    <tbody>\n      <tr>\n        <td class="attribute-label">author</td>\n        <td>\n          ',u=n.author,u?o=u.call(t,{hash:{}}):(o=t.author,o=typeof o===a?o():o),s+=f(o)+'\n        </td>\n      </tr>\n      <tr>\n        <td class="attribute-label">repo</td>\n        <td><a href="https://github.com/',u=n.repo,u?o=u.call(t,{hash:{}}):(o=t.repo,o=typeof o===a?o():o),s+=f(o)+'" title="GitHub repository for ',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+'">',u=n.repo,u?o=u.call(t,{hash:{}}):(o=t.repo,o=typeof o===a?o():o),s+=f(o)+'</a></td>\n      </tr>\n      <tr>\n        <td class="attribute-label">keywords</td>\n        <td>',u=n.keywords,u?o=u.call(t,{hash:{}}):(o=t.keywords,o=typeof o===a?o():o),s+=f(o)+'</td>\n      </tr>\n      <tr>\n        <td class="attribute-label">updated</td>\n        <td>',u=n.updated,u?o=u.call(t,{hash:{}}):(o=t.updated,o=typeof o===a?o():o),s+=f(o)+'</td>\n      </tr>\n      <tr>\n        <td class="attribute-label">watchers</td>\n        <td>',u=n.watchers,u?o=u.call(t,{hash:{}}):(o=t.watchers,o=typeof o===a?o():o),s+=f(o)+" stars</td>\n      </tr>\n    </tbody>\n  </table>\n\n</div>\n",s},this.app.templates.player=function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="row">\n  <select class="samples">\n    <option value="vox">vocals</li>\n    <option value="lead">acoustic guitar lead</li>\n    <option value="rhythm">acoustic guitar rhythm</li>\n    <option value="solo-dry">electric guitar lead</li>\n  </select>\n  <div class="module well">\n    <h3>',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+"</h3>\n\n  </div>\n</div>\n\n",s},this.app.templates.searchBar=function(e,t,n,r,i){return n=n||e.helpers,'<div class="row">\n  <form class="form-search">\n    <div class="input-prepend">\n      <span class="add-on"><i class="icon icon-search"></i></span>\n      <input type="search" class="search-query" id="search-bar" placeholder="plate delay"/>\n    </div>\n  </form>\n</div>\n'},this.app.templates.searchResults=function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n    <h2>Results for ",s=n.query,s?i=s.call(e,{hash:{}}):(i=e.query,i=typeof i===u?i():i),r+=a(i)+"</h2>\n  ",r}function c(e,t){return"\n    <h2>Recent packages</h2>\n  "}function h(e,t){var r="",i,s;return r+='\n      <li><a href="#" data-id="',s=n.id,s?i=s.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i():i),r+=a(i)+'" data-name="',s=n.name,s?i=s.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i():i),r+=a(i)+'">',s=n.name,s?i=s.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i():i),r+=a(i)+" - ",s=n.description,s?i=s.call(e,{hash:{}}):(i=e.description,i=typeof i===u?i():i),r+=a(i)+"</a></li>\n    ",r}n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="row">\n  ',o=t.query,o=n["if"].call(t,o,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\n  <ul class="nav nav-tabs nav-stacked">\n    ',o=t.packages,o=n.each.call(t,o,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+="\n  </ul>\n</div>\n",s},function(){app.models.Package=Backbone.Model.extend({initialize:function(){},matches:function(e){var t=e.split(" "),n=!1,r=this;return t=_.map(t,function(e){return new RegExp(e,"gi")}),_.each(t,function(e){if(_.any(r.get("keywords")||[],function(t){return t.match(e)})||r.get("description").match(e)||r.get("name").match(e))n=!0}),n}})}(),function(){app.collections.Packages=Backbone.Collection.extend({model:app.models.Package,url:"/packages",initialize:function(){}})}(),function(){var e=app.views.index,t=app.views.search,n=app.views.package,r=app.views.about,i=Backbone.Router.extend({routes:{"":"index","packages/search/:name":"search","packages/:package":"package",about:"about"},index:function(){},search:function(){}});app.router=new i}(),function(){app.views.View=Backbone.View.extend({render:function(){this.template=this.template||Handlebars.template(app.templates[this.name]);var e=this.getRenderData?this.getRenderData():{};$("#content").append(this.$el.html(this.template(e)))}})}(),function(){app.views.Index=app.views.View.extend({name:"index",className:"index-view",initialize:function(){this.render()},events:{}})}(),function(){app.views.Package=app.views.View.extend({name:"package",className:"package-view",initialize:function(e){this.packages=e.packages,this.packages.on("select",this.setPackage,this)},setPackage:function(e){app.router.navigate("/package/"+e.get("name")),this.package=e,this.render()},getRenderData:function(){var e=this.package.toJSON();return e.updated=this.formatDate(e.updated),e.keywords=this.formatKeywords(e.keywords),console.log(e.keywords),e},formatDate:function(e){return moment(e).format("MMMM Do YYYY")},formatKeywords:function(e){return console.log(e),(e||[]).join(", ")}})}(),function(){app.views.Player=app.views.View.extend({name:"player",className:"player-view",initialize:function(){this.context=new(window.AudioContext||window.webkitAudioContext),app.packageView.on("select:package",this.loadPackage,this),this.$el.data("hidden",!0),this.$(".samples").change(),this.render()},events:{"change .samples":"handleLoadSample"},loadPackage:function(e){var t=this;this.$el.data("hidden")&&this.showPlayer(),require(["/packages/"+e+"/script.js"],function(e){t.module=new e(t.context),t.packageLoaded(),t.module.connect(t.context.destination)})},packageLoaded:function(){},handleLoadSample:function(e){var t=$(e.target).find(":selected").val();this.loadSample(t)},loadSample:function(e){var t=this;this.source&&this.source.noteOff&&this.source.noteOff(0),this.source=this.context.createBufferSource();var n=new XMLHttpRequest;n.open("GET","samples/"+e+".mp3",!0),n.responseType="arraybuffer",n.onload=function(e){t.loadedSample(e,n)},n.send()},loadedSample:function(e,t){this.source.buffer=this.context.createBuffer(t.response,!1),this.module&&this.source.connect(this.module.input),this.source.noteOn(0)},showPlayer:function(){this.$el.animate({"margin-bottom":"0px"}),this.$el.data("hidden",!1)},hidePlayer:function(){this.$el.animate({"margin-bottom":"-150px"}),this.$el.data("hidden",!0)}})}(),function(){app.views.SearchBar=app.views.View.extend({name:"searchBar",className:"search-bar-view",initialize:function(){var e=this;this.triggerQuery=_.debounce(function(t){e.trigger("query",t)},200),this.render()},events:{"keyup #search-bar":"handleSearch"},handleSearch:function(e){var t=$(e.target).val();t=this.sanitizeQuery(t),this.triggerQuery(t),app.indexView.$el.slideUp()},sanitizeQuery:function(e){return e.replace(/[^\w ]/g,"")}})}(),function(){app.views.SearchResults=app.views.View.extend({name:"searchResults",className:"search-results-view",events:{"click a":"handlePackageSelect"},initialize:function(e){var t=this;this.search=e.search,this.packages=e.packages,this.filteredPackages=this.packages,this.search.on("query",this.filterPackages,this),this.packages.fetch({success:function(){t.render()}})},filterPackages:function(e){var t;e?(t=this.packages.filter(function(t){return t.matches(e)}),this.filteredPackages=new app.collections.Packages(t)):this.filteredPackages=this.packages,app.router.navigate("/package/search/"+e),this.query=e,this.render()},getRenderData:function(){return{packages:this.filteredPackages.toJSON(),query:this.query}},handlePackageSelect:function(e){var t=$(e.target).data("name"),n=this.packages.where({name:t})[0];e.preventDefault(),this.packages.trigger("select",n)}})}(),app.init=function(){app.packages=new app.collections.Packages,app.indexView=new app.views.Index,app.searchBarView=new app.views.SearchBar,app.searchResultsView=new app.views.SearchResults({search:app.searchBarView,packages:app.packages}),app.packageView=new app.views.Package({resultsView:app.searchResultsView,packages:app.packages}),app.playerView=new app.views.Player({packageView:app.packageView})},$(function(){app.init.call(app),Backbone.history.start()});